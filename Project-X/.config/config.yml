data :
  read :
    - cold_start_test :
      skip : [0]
    - consumption_train :
      skip : [0]
    - meta
    - submission_format

concat :
  data :
    target : cold_start_test
    dataframes :
      - consumption_train

cache : true

ohe :
  - data : meta
    skip : 
      - series_id

customize-cells :
  - data : meta
    func : ohe_true_false

copy-data-1:
  from : submission_format
  to : submission

# Takes array as input and return True against the values to delete and False for not to delete 
delete-rows-0 :
  - data : cold_start_test
    in-col : temperature
    condition : is_temp_na
  - data : submission
    in-col : temperature
    condition : is_temp_na
  - data : submission
    in-col : prediction_window
    condition : weekly
  - data : submission
    in-col : prediction_window
    condition : daily

generate-column :
  - data : cold_start_test
    func : get_week_from_timestamp
    in-col : timestamp
    out-col : week
  - data : submission
    func : get_week_from_timestamp
    in-col : timestamp
    out-col : week
  # - data : cold_start_test
  #   func : get_day_from_timestamp
  #   in-col : timestamp
  #   out-col : day
  - data : cold_start_test
    func : get_day_from_timestamp
    in-col : timestamp
    out-col : on_off
  - data : cold_start_test
    func : get_hour_from_timestamp
    in-col : timestamp
    out-col : hour
  # - data : submission
  #   func : get_day_from_timestamp
  #   in-col : timestamp
  #   out-col : day
  - data : submission
    func : get_day_from_timestamp
    in-col : timestamp
    out-col : on_off
  - data : submission
    func : get_hour_from_timestamp
    in-col : timestamp
    out-col : hour

merge:
  - left : cold_start_test
    right : meta
    how : left
    on : series_id
  - left : submission
    right : meta
    how : left
    on : series_id

# Takes series as input
customize-row :
  - data : cold_start_test
    func : replace_day_with_off
  - data : submission
    func : replace_day_with_off

delete-columns :
  - data : cold_start_test
    columns:
      - monday_is_day_off
      - tuesday_is_day_off
      - wednesday_is_day_off
      - thursday_is_day_off
      - friday_is_day_off
      - saturday_is_day_off
      - sunday_is_day_off
  - data : submission
    columns:
      - monday_is_day_off
      - tuesday_is_day_off
      - wednesday_is_day_off
      - thursday_is_day_off
      - friday_is_day_off
      - saturday_is_day_off
      - sunday_is_day_off
      - prediction_window

group-by :
  - data : cold_start_test
    group-on :
      - series_id
      - week
      - hour
      - on_off
    as_index : False

csv-0 :
  index : false
  data :
    - cold_start_test
    
csv-1 :
  data :
    - meta

# keras:
#   train :
#     data : cold_start_test
#     skip : [series_id]
#     output : consumption
#     activation : softmax
#     model : sequential
#     initializer : normal
#     loss : mean_squared_error
#     optimizer : sgd
#     metrics : [accuracy]
#     validate : true
#     epochs : 20
#   predict :
#     data : submission

lightgbm :
  train :
    data : cold_start_test
    skip : [series_id]
    output : consumption
    type : LGBMRegressor
  predict :
    data : submission

transfer:
  from :
    data : submission
    key : [series_id, timestamp]
    col : consumption
  to :
    data : submission_format
    key : [series_id, timestamp]
    col : consumption

csv-2 :
  data :
    - submission
    - submission_format

# copy-data-2:
#   from : cold_start_test
#   to : cold_start_test_daily

# customize-column :
#   - data : cold_start_test_daily
#     func : get_date_from_timestamp
#     in-col : timestamp
 
# group-by :
#   - data : cold_start_test
#     group-on :
#       - timestamp
#     aggregation:
#       - consumption : sum
#       - temperature : mean